# Benchmark Scripts

This directory contains scripts for comparing fast-yaml performance with other YAML tools.

## Prerequisites

- **hyperfine**: Install with `brew install hyperfine`
- **Python 3.10+**: For Python API benchmarks
- **yamlfmt** (optional): For CLI benchmarks - `brew install yamlfmt`

## Available Benchmarks

### 1. Python API Benchmarks

Compare fast-yaml Python bindings with PyYAML (pure Python and C LibYAML versions).

**Setup:**

```bash
bash setup_python_benchmarks.sh
```

This will:
- Create a Python virtual environment
- Install PyYAML
- Build fast-yaml Python bindings

**Run benchmarks:**

```bash
bash run_python_benchmark.sh
```

**Output:**
- Individual results: `../results/python_*_<timestamp>.{json,md}`
- Summary report: `../results/python_summary_<timestamp>.md`

**What's tested:**

| Test | Description |
|------|-------------|
| Parse (small) | 502 bytes YAML file parsing |
| Parse (medium) | 44 KB YAML file parsing |
| Parse (large) | 449 KB YAML file parsing |
| Dump (small) | 502 bytes YAML serialization |
| Dump (medium) | 44 KB YAML serialization |
| Dump (large) | 449 KB YAML serialization |

Each test compares:
- fast-yaml (Rust-based)
- PyYAML pure Python
- PyYAML with C LibYAML (if available)

### 2. CLI Benchmarks

Compare fast-yaml CLI with yamlfmt.

**Run:**

```bash
bash run_benchmark.sh         # Single file benchmarks
bash run_batch_benchmark.sh   # Multi-file batch benchmarks
```

## Benchmark Methodology

All benchmarks use **hyperfine** with:
- `--warmup 3`: 3 warmup runs to eliminate cold-start effects
- `--runs 10`: 10 measurement runs for statistical significance
- `--export-markdown`: Results exported to markdown tables
- `--export-json`: Raw data for further analysis

## Understanding Results

Hyperfine reports include:

| Column | Description |
|--------|-------------|
| Mean | Average execution time |
| Min/Max | Fastest and slowest runs |
| Relative | Speedup compared to baseline (1.00 = baseline) |

**Example:**

```markdown
| Command | Mean [ms] | Relative |
|---------|-----------|----------|
| fast-yaml | 2.5 ± 0.4 | 1.00 |
| PyYAML pure | 35.2 ± 1.2 | 14.08 ± 2.34 |
```

This shows fast-yaml is **14x faster** than PyYAML pure Python.

## Performance Expectations

Based on Rust performance characteristics:

| Comparison | Expected Speedup |
|------------|------------------|
| fast-yaml vs PyYAML (pure) | 10-15x |
| fast-yaml vs PyYAML (C) | 2-5x |
| fast-yaml vs yamlfmt (CLI) | 1-3x |

## Troubleshooting

**"hyperfine not found"**
```bash
brew install hyperfine
```

**"PyYAML not found"**
```bash
bash setup_python_benchmarks.sh
```

**"fast-yaml not found"**
```bash
cd python && maturin develop
```

**Inconsistent results**
- Close other applications
- Ensure stable CPU frequency (disable Turbo Boost for consistency)
- Increase `--runs` parameter for more samples

## Benchmark Corpus

Test files are located in `../corpus/generated/`:

- `small_0.yaml` - 502 bytes (minimal YAML)
- `medium_0.yaml` - 44 KB (typical configuration file)
- `large_0.yaml` - 449 KB (large dataset)

These files are generated by `generate_corpus.py` with realistic YAML structures.
